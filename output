var player={x:320,y:10,width:10,height:20,velx:0,vely:0,grounded:false};var lines=[];var lastlinestandingon=null;var spanwleveltimer=0;var testline={x1:0,y1:0,x2:0,y2:0};function draw(){rectfill(canvas,player.x,player.y,player.width,player.height,makecol(255,0,0),0);for(var i=0;i<lines.length;i++){var ln=lines[i];if(ln.ison){line(canvas,ln.x1,ln.y1,ln.x2,ln.y2,makecol(0,0,0),4)}var bombpos=pingpong(ln.bomb,640);circlefill(canvas,bombpos,ln.y1,20,makecol(255,0,0))}}function update(){if(player.y>480){initgame()}var targx=player.x;var targy=player.y;if(key[KEY_A])targx-=4;if(key[KEY_D])targx+=4;if(player.grounded&&pressed[KEY_W]){player.grounded=false;player.vely=-4.5}targy+=player.vely;player.vely+=.3;var xmove=targx-player.x;var dir=Math.sign(xmove);if(dir!=0){xmove=Math.abs(xmove);for(var i=0;i<xmove;i++){if(hitsline(player,dir,0,lines)==null){player.x+=dir}else break}}var ymove=targy-player.y;var dir=Math.sign(ymove);if(dir!=0){player.grounded=false;ymove=Math.abs(ymove);for(var i=0;i<ymove;i++){var hit=hitsline(player,0,dir,lines);if(hit==null){player.y+=dir}else{if(dir>=0){player.grounded=true;lastlinestandingon=hit}player.vely=0;break}}}if(!player.grounded){if(lastlinestandingon!=null){lastlinestandingon.ison=false;lastlinestandingon=null}}var gamespeed=1.5;player.y-=gamespeed;for(var i=0;i<lines.length;i++){var newy=lines[i].y1-gamespeed;if(newy<-10){lines.splice(i,1);i--}else{lines[i].y1=newy;lines[i].y2=newy}}spanwleveltimer-=gamespeed;if(spanwleveltimer<=0){addline(640);spanwleveltimer+=80}for(var i=0;i<lines.length;i++){var ln=lines[i];ln.bomb+=4}}function pingpong(amnt,max){if(amnt<max){return amnt}var dir=1;while(amnt>max){amnt-=max;dir*=-1}if(dir==1){return amnt}return max-amnt}function hitsline(ent,xoffset,yoffset,lineslist){var hw=ent.width/2;testline.x1=ent.x+xoffset+hw;testline.y1=ent.y+yoffset;testline.x2=ent.x+xoffset+hw;testline.y2=ent.y+yoffset+ent.height;for(var i=0;i<lineslist.length;i++){if(lineslist[i].ison==false){continue}if(lineobjintersection(testline,lineslist[i])){return lineslist[i]}}return null}function lineobjintersection(line1,line2){return lineintersection(line1.x1,line1.y1,line1.x2,line1.y2,line2.x1,line2.y1,line2.x2,line2.y2)}function lineintersection(p0_x,p0_y,p1_x,p1_y,p2_x,p2_y,p3_x,p3_y){var s1_x,s1_y,s2_x,s2_y;s1_x=p1_x-p0_x;s1_y=p1_y-p0_y;s2_x=p3_x-p2_x;s2_y=p3_y-p2_y;var s,t;s=(-s1_y*(p0_x-p2_x)+s1_x*(p0_y-p2_y))/(-s2_x*s1_y+s1_x*s2_y);t=(s2_x*(p0_y-p2_y)-s2_y*(p0_x-p2_x))/(-s2_x*s1_y+s1_x*s2_y);if(s>=0&&s<=1&&t>=0&&t<=1){return true}return false}function addline(y){var x1=rand()%300;var x2=640-rand()%300;var wid=x2-x1;var bombpos=x1+rand()%wid;var newline={x1:x1,y1:y,x2:x2,y2:y,ison:true,bomb:bombpos};lines.push(newline)}function initgame(){var y=80*5;for(var i=0;i<5;i++){addline(y);y+=80}}function main(){enable_debug("debug");set_gfx_mode("canvas_id",640,480);install_keyboard([]);initgame();ready(function(){loop(function(){clear_to_color(canvas,makecol(215,215,215));update();draw()},BPS_TO_TIMER(60))});return 0}END_OF_MAIN();function install_allegro(){if(!Date.now)Date.now=function now(){return(new Date).getTime()};log("Allegro installed!")}function allegro_init(){install_allegro()}function allegro_init_all(id,w,h,menu,enable_keys){install_allegro();set_gfx_mode(id,w,h);install_mouse(menu);install_keyboard(enable_keys);install_sound()}function END_OF_MAIN(){window.addEventListener("load",main)}var mouse_b=0;var mouse_pressed=0;var mouse_released=0;var mouse_x=-1;var mouse_y=-1;var mouse_z=-1;var mouse_mx=0;var mouse_my=0;var mouse_mz=0;var _mouse_installed=false;var _last_mouse_x=-1;var _last_mouse_y=-1;var _last_mouse_z=-1;var _menu=false;function install_mouse(menu){if(!canvas){_error("You must call set_gfx_mode before install_mouse");return-1}if(_mouse_installed){_allog("Mouse already installed");return-1}canvas.canvas.addEventListener("mouseup",_mouseup);canvas.canvas.addEventListener("mousedown",_mousedown);canvas.canvas.addEventListener("mousemove",_mousemove);canvas.canvas.addEventListener("wheel",_mousewheel);if(menu){_menu_supress=true}else{canvas.canvas.addEventListener("contextmenu",_mousemenu);_menu_supress=false}_mouse_installed=true;log("Mouse installed!");return 0}function remove_mouse(){if(!_mouse_installed){_error("You must call install_mouse before remove_mouse");return-1}canvas.canvas.removeEventListener("mouseup",_mouseup);canvas.canvas.removeEventListener("mousedown",_mousedown);canvas.canvas.removeEventListener("mousemove",_mousemove);canvas.canvas.removeEventListener("wheel",_mousewheel);if(_menu_supress)canvas.canvas.removeEventListener("contextmenu",_mousemenu);_mouse_installed=false;log("Mouse removed!");return 0}function show_mouse(){if(!_mouse_installed){_error("You must call install_mouse before show_mouse");return-1}canvas.canvas.style.cursor="auto";return 0}function hide_mouse(){if(!_mouse_installed){_error("You must call install_mouse before hide_mouse");return-1}canvas.canvas.style.cursor="none";return 0}function _mousemenu(e){e.preventDefault()}function _mouseup(e){mouse_b=mouse_b&~(1<<e.which-1);mouse_released=mouse_released|1<<e.which-1;e.preventDefault()}function _mousedown(e){mouse_b=mouse_b|1<<e.which-1;mouse_pressed=mouse_pressed|1<<e.which-1;e.preventDefault()}function _mousemove(e){mouse_x=e.offsetX;mouse_y=e.offsetY;e.preventDefault()}function _mousewheel(e){mouse_z+=e.deltaY;e.preventDefault()}function TOUCH_OBJECT(x,y,mx,my,px,py,sx,sy,id,age,dead){}var _touch_installed=false;var touch=[];var touch_pressed=[];var touch_released=[];function install_touch(){if(!canvas){_error("You must call set_gfx_mode before install_touch");return-1}if(_touch_installed){_allog("Touch already installed");return-1}canvas.canvas.addEventListener("touchstart",_touchstart);canvas.canvas.addEventListener("touchend",_touchend);canvas.canvas.addEventListener("touchcancel",_touchend);canvas.canvas.addEventListener("touchmove",_touchmove);_touch_installed=true;log("Touch installed!")}function remove_touch(){if(!canvas){_error("You must call set_gfx_mode before install_touch");return-1}if(!_touch_installed){_allog("Touch not installed");return-1}canvas.canvas.removeEventListener("touchstart",_touchstart);canvas.canvas.removeEventListener("touchend",_touchend);canvas.canvas.removeEventListener("touchcancel",_touchend);canvas.canvas.removeEventListener("touchmove",_touchmove);_touch_installed=false;log("Touch removed!")}function _get_touch(id){for(var c=0;c<touch.length;c++){if(touch[c].id==id)return touch[c]}return null}function _touchstart(e){var rect=e.target.getBoundingClientRect();for(var c=0;c<e.changedTouches.length;c++){var point=e.changedTouches.item(c);var t={sx:point.clientX-rect.left,sx:point.clientY-rect.top,mx:0,my:0,px:point.clientX-rect.left,py:point.clientY-rect.top,x:point.clientX-rect.left,y:point.clientY-rect.top,id:point.identifier,dead:false,age:0};touch.push(t);touch_pressed.push(t)}e.preventDefault()}function _touchend(e){for(var c=0;c<e.changedTouches.length;c++){var point=e.changedTouches.item(c);var t=_get_touch(point.identifier);if(t){touch.splice(touch.indexOf(t),1);touch_released.push(t);t.dead=true}}e.preventDefault()}function _touchmove(e){var rect=e.target.getBoundingClientRect();for(var c=0;c<e.changedTouches.length;c++){var point=e.changedTouches.item(c);var t=_get_touch(point.identifier);if(t){var x=point.clientX-rect.left;var y=point.clientY-rect.top;t.mx+=t.x-x;t.my+=t.y-y;t.x=x;t.y=y}}e.preventDefault()}var _downloadables=[];var _installed_timers=[];function _timer_lookup(proc){for(var c=0;c<_installed_timers.length;c++){if(_installed_timers[c].timer==proc)return _installed_timers[c]}return-1}function SECS_TO_TIMER(secs){return secs*1e3}function MSEC_TO_TIMER(msec){return msec}function BPS_TO_TIMER(bps){return 1e3/bps}function BPM_TO_TIMER(bpm){return 60*1e3/bpm}function install_timer(){}function time(){return Date.now()}function install_int(procedure,msec){return install_int_ex(procedure,MSEC_TO_TIMER(msec))}function install_int_ex(procedure,speed){var timer_id=window.setInterval(procedure,speed);_installed_timers.push({timer:procedure,id:timer_id});log("Added insterrupt #"+timer_id+" at "+speed+"msec isntervals!")}var _loopproc;function _uberloop(){if(_mouse_installed){mouse_mx=mouse_x-_last_mouse_x;mouse_my=mouse_y-_last_mouse_y;mouse_mz=mouse_z-_last_mouse_z}_loopproc();if(_keyboard_installed){for(var c=0;c<128;c++){pressed[c]=false;released[c]=false}}if(_mouse_installed){mouse_pressed=0;mouse_released=0;mouse_mx=0;mosue_my=0;mouse_mz=0;_last_mouse_x=mouse_x;_last_mouse_y=mouse_y;_last_mouse_z=mouse_z}if(_touch_installed){touch_released=[];touch_pressed=[];for(var c=0;c<touch.length;c++){touch[c].mx=0;touch[c].my=0;touch[c].px=touch[c].x;touch[c].py=touch[c].y;touch[c].age++}}}function loop(procedure,speed){_loopproc=procedure;var timer_id=window.setInterval(_uberloop,speed);log("Game loop initialised!")}var _loader_init_time;var _ready_proc;var _bar_proc;function _progress_check(){var num_assets=0;var num_loaded=0;for(var c=0;c<_downloadables.length;c++){num_assets++;if(_downloadables[c].type=="snd"){if(_downloadables[c].element.readyState>=_downloadables[c].element.HAVE_FUTURE_DATA)_downloadables[c].ready=true}if(_downloadables[c].ready)num_loaded++}if(_bar_proc)_bar_proc(num_assets/num_loaded);if(num_loaded<num_assets){window.setTimeout(_progress_check,100)}else{log("Loading complete! Took "+((time()-_loader_init_time)/1e3).toFixed(1)+" seconds!");_ready_proc()}}function loading_bar(progress){rectfill(canvas,5,SCREEN_H-55,SCREEN_W-10,50,makecol(0,0,0));rectfill(canvas,10,SCREEN_H-50,SCREEN_W-20,40,makecol(255,255,255));rectfill(canvas,15,SCREEN_H-45,SCREEN_W-30,30,makecol(0,0,0));rectfill(canvas,20,SCREEN_H-40,scaleclamp(progress,0,1,0,SCREEN_W-40),20,makecol(255,255,255))}function ready(procedure,bar){_loader_init_time=time();_ready_proc=procedure;log("Loader initialised!");if(bar)_bar_proc=bar;else _bar_proc=loading_bar;window.setTimeout(_progress_check,100)}function remove_int(procedure){for(var c=0;c<_installed_timers.length;c++){if(_installed_timers[c].timer==_installed_timers){log("Removing interrupt "+_installed_timers[c].id+"!");window.clearInterval(_installed_timers[c].id);_installed_timers.splice(c,1);return}}}function remove_all_ints(){for(var c=0;c<_installed_timers.length;c++){window.clearInterval(_installed_timers[c].id)}_installed_timers=[];log("Removed all interrupts!")}var KEY_A=65,KEY_B=66,KEY_C=67,KEY_D=68,KEY_E=69,KEY_F=70,KEY_G=71,KEY_H=72,KEY_I=73,KEY_J=74,KEY_K=75,KEY_L=76,KEY_M=77,KEY_N=78,KEY_O=79,KEY_P=80,KEY_Q=81,KEY_R=82,KEY_S=83,KEY_T=84,KEY_U=85,KEY_V=86,KEY_W=87,KEY_X=88,KEY_Y=89,KEY_Z=90,KEY_0=48,KEY_1=49,KEY_2=50,KEY_3=51,KEY_4=52,KEY_5=53,KEY_6=54,KEY_7=55,KEY_8=56,KEY_9=57,KEY_0_PAD=96,KEY_1_PAD=97,KEY_2_PAD=98,KEY_3_PAD=99,KEY_4_PAD=100,KEY_5_PAD=101,KEY_6_PAD=102,KEY_7_PAD=103,KEY_8_PAD=104,KEY_9_PAD=105,KEY_F1=112,KEY_F2=113,KEY_F3=114,KEY_F4=115,KEY_F5=116,KEY_F6=117,KEY_F7=118,KEY_F8=119,KEY_F9=120,KEY_F10=121,KEY_F11=122,KEY_F12=123,KEY_ESC=27,KEY_TILDE=192,KEY_MINUS=189,KEY_EQUALS=187,KEY_BACKSPACE=8,KEY_TAB=9,KEY_OPENBRACE=219,KEY_CLOSEBRACE=221,KEY_ENTER=13,KEY_COLON=186,KEY_QUOTE=222,KEY_BACKSLASH=220,KEY_COMMA=188,KEY_STOP=190,KEY_SLASH=191,KEY_SPACE=32,KEY_INSERT=45,KEY_DEL=46,KEY_HOME=36,KEY_END=35,KEY_PGUP=33,KEY_PGDN=34,KEY_LEFT=37,KEY_RIGHT=39,KEY_UP=38,KEY_DOWN=40,KEY_SLASH_PAD=111,KEY_ASTERISK=106,KEY_MINUS_PAD=109,KEY_PLUS_PAD=107,KEY_ENTER_PAD=13,KEY_PRTSCR=44,KEY_PAUSE=19,KEY_EQUALS_PAD=12,KEY_LSHIFT=16,KEY_RSHIFT=16,KEY_LCONTROL=17,KEY_RCONTROL=17,KEY_ALT=18,KEY_ALTGR=18,KEY_LWIN=91,KEY_RWIN=92,KEY_MENU=93,KEY_SCRLOCK=157,KEY_NUMLOCK=144,KEY_CAPSLOCK=20;var key=[];var pressed=[];var released=[];var _keyboard_installed=false;var _default_enabled_keys=[KEY_F1,KEY_F2,KEY_F3,KEY_F4,KEY_F5,KEY_F6,KEY_F7,KEY_F8,KEY_F9,KEY_F10,KEY_F11,KEY_F12];var _enabled_keys=[];function install_keyboard(enable_keys){if(_keyboard_installed){_allog("Keyboard already installed");return-1}if(enable_keys){_enabled_keys=enable_keys}else{_enabled_keys=_default_enabled_keys}for(var c=0;c<128;c++){key[c]=false;pressed[c]=false;released[c]=false}document.addEventListener("keyup",_keyup);document.addEventListener("keydown",_keydown);_keyboard_installed=true;log("Keyboard installed!");return 0}function remove_keyboard(){if(!_keyboard_installed){_allog("Keyboard not installed");return-1}document.removeEventListener("keyup",_keyup);document.removeEventListener("keydown",_keydown);_keyboard_installed=false;log("Keyboard removed!");return 0}function _keydown(e){if(!key[e.keyCode])pressed[e.keyCode]=true;key[e.keyCode]=true;if(_enabled_keys.indexOf(e.keyCode)==-1)e.preventDefault()}function _keyup(e){key[e.keyCode]=false;released[e.keyCode]=true;if(_enabled_keys.indexOf(e.keyCode)==-1)e.preventDefault()}function BITMAP_OBJECT(w,h,canvas,context,ready,type){}function create_bitmap(width,height){log("Creating bitmap at "+width+" x "+height+"!");var cv=document.createElement("canvas");cv.width=width;cv.height=height;var ctx=cv.getContext("2d");return{w:width,h:height,canvas:cv,context:ctx,ready:true,type:"bmp"}}function load_bitmap(filename){log("Loading bitmap "+filename+"...");var img=new Image;img.src=filename;var now=time();var cv=document.createElement("canvas");var ctx=cv.getContext("2d");var bmp={canvas:cv,context:ctx,w:-1,h:-1,ready:false,type:"bmp"};_downloadables.push(bmp);img.onload=function(){log("Bitmap "+filename+" loaded, size: "+img.width+" x "+img.height+"!");bmp.canvas.width=img.width;bmp.canvas.height=img.height;bmp.context.drawImage(img,0,0);bmp.w=img.width;bmp.h=img.height;bmp.ready=true};return bmp}function load_bmp(filename){return load_bitmap(filename)}function load_sheet(filename,w,h){log("Loading spritesheet "+filename+"...");var img=new Image;img.src=filename;var now=time();var cv=document.createElement("canvas");var ctx=cv.getContext("2d");var bmp={canvas:cv,context:ctx,w:-1,h:-1,ready:false,type:"bmp"};var sheet=[];_downloadables.push(bmp);img.onload=function(){log("Sheet "+filename+" loaded, size: "+img.width+" x "+img.height+"!");bmp.canvas.width=img.width;bmp.canvas.height=img.height;bmp.context.drawImage(img,0,0);bmp.w=img.width;bmp.h=img.height;bmp.ready=true;var nx=Math.floor(bmp.w/w),ny=Math.floor(bmp.h/h);for(var y=0;y<ny;y++){for(var x=0;x<nx;x++){var frame=create_bitmap(w,h);blit(bmp,frame,x*w,y*h,0,0,w,h);sheet.push(frame)}}log("Created "+frame.length+" frames, each is "+w+"x"+h+"!")};return sheet}var canvas;var _gfx_installed=false;var SCREEN_W=0;var SCREEN_H=0;var font;function set_gfx_mode(canvas_id,width,height,smooth){smooth=typeof smooth!=="undefined"?smooth:true;var cv=document.getElementById(canvas_id);if(!cv){_error("Can't find canvas with id "+canvas_id);return-1}var rect=cv.getBoundingClientRect();if(!width)width=rect.width;if(!height)height=rect.height;cv.width=width;cv.height=height;var ctx=cv.getContext("2d");ctx.mozImageSmoothingEnabled=smooth;ctx.webkitImageSmoothingEnabled=smooth;ctx.imageSmoothingEnabled=smooth;SCREEN_W=width;SCREEN_H=height;canvas={w:width,h:height,canvas:cv,context:ctx,ready:true};font=load_base64_font(_cartoon_woff);_gfx_installed=true;log("Graphics mode set to "+width+" x "+height);return 0}var PI=3.14159265;var PI2=2*3.14159265;var PI_2=3.14159265/2;var PI_3=3.14159265/3;var PI_4=3.14159265/4;function RAD(d){return-d*PI/180}function DEG(r){return-r*180/PI}function _fillstyle(bitmap,colour){bitmap.context.fillStyle="rgba("+getr(colour)+","+getg(colour)+","+getb(colour)+","+getaf(colour)+")"}function _strokestyle(bitmap,colour,width){if(!width)width=1;bitmap.context.lineWidth=width;bitmap.context.strokeStyle="rgba("+getr(colour)+","+getg(colour)+","+getb(colour)+","+getaf(colour)+")"}function makecol(r,g,b,a){a=typeof a!=="undefined"?a:255;return a<<24|(r&255)<<16|(g&255)<<8|b&255}function makecolf(r,g,b,a){a=typeof a!=="undefined"?a:1;return makecol(r*255,g*255,b*255,a*255)}function getr(colour){return colour>>16&255}function getg(colour){return colour>>8&255}function getb(colour){return colour&255}function geta(colour){return colour>>>24}function getrf(colour){return colour>>16&255/255}function getgf(colour){return colour>>8&255/255}function getbf(colour){return colour&255/255}function getaf(colour){return(colour>>>24)/255}function getpixel(bitmap,x,y){var data=bitmap.context.getImageData(x,y,1,1).data;return data[3]<<24|(data[0]&255)<<16|(data[1]&255)<<8|data[2]&255}function putpixel(bitmap,x,y,colour){_fillstyle(bitmap,colour);bitmap.context.fillRect(x,y,1,1)}function clear_bitmap(bitmap){bitmap.context.clearRect(0,0,bitmap.w,bitmap.h)}function clear_to_color(bitmap,colour){bitmap.context.clearRect(0,0,bitmap.w,bitmap.h);_fillstyle(bitmap,colour);bitmap.context.fillRect(0,0,bitmap.w,bitmap.h)}function line(bitmap,x1,y1,x2,y2,colour,width){_strokestyle(bitmap,colour,width);bitmap.context.beginPath();bitmap.context.moveTo(x1,y1);bitmap.context.lineTo(x2,y2);bitmap.context.stroke()}function vline(bitmap,x,y1,y2,colour,width){width=typeof width!=="undefined"?width:1;_fillstyle(bitmap,colour);bitmap.context.fillRect(x-width/2,y1,width,y2-y1)}function hline(bitmap,x1,y,x2,colour,width){width=typeof width!=="undefined"?width:1;_fillstyle(bitmap,colour);bitmap.context.fillRect(x1,y-width/2,x2-x1,width)}function triangle(bitmap,x1,y1,x2,y2,x3,y3,colour,width){_strokestyle(bitmap,colour,width);bitmap.context.beginPath();bitmap.context.moveTo(x1,y1);bitmap.context.lineTo(x2,y2);bitmap.context.lineTo(x3,y3);bitmap.context.closePath();bitmap.context.stroke()}function trianglefill(bitmap,x1,y1,x2,y2,x3,y3,colour){_fillstyle(bitmap,colour);bitmap.context.beginPath();bitmap.context.moveTo(x1,y1);bitmap.context.lineTo(x2,y2);bitmap.context.lineTo(x3,y3);bitmap.context.closePath();bitmap.context.fill()}function polygon(bitmap,vertices,points,colour,width){_strokestyle(bitmap,colour,width);bitmap.context.beginPath();for(var c=0;c<vertices;c++){if(c)bitmap.context.lineTo(points[c*2],points[c*2+1]);else bitmap.context.moveTo(points[c*2],points[c*2+1])}bitmap.context.closePath();bitmap.context.stroke()}function polygonfill(bitmap,vertices,points,colour){_fillstyle(bitmap,colour);bitmap.context.beginPath();for(var c=0;c<vertices;c++){if(c)bitmap.context.lineTo(points[c*2],points[c*2+1]);else bitmap.context.moveTo(points[c*2],points[c*2+1])}bitmap.context.closePath();bitmap.context.fill()}function rect(bitmap,x1,y1,w,h,colour,width){_strokestyle(bitmap,colour,width);bitmap.context.strokeRect(x1,y1,w,h)}function rectfill(bitmap,x1,y1,w,h,colour){_fillstyle(bitmap,colour);bitmap.context.fillRect(x1,y1,w,h)}function circle(bitmap,x,y,radius,colour,width){_strokestyle(bitmap,colour,width);bitmap.context.beginPath();bitmap.context.arc(x,y,radius,0,PI2);bitmap.context.stroke()}function circlefill(bitmap,x,y,radius,colour){_fillstyle(bitmap,colour);bitmap.context.beginPath();bitmap.context.arc(x,y,radius,0,PI2);bitmap.context.fill()}function arc(bitmap,x,y,ang1,ang2,r,colour,width){_strokestyle(bitmap,colour,width);bitmap.context.beginPath();if(ang1>ang2){bitmap.context.arc(x,y,r,RAD(ang1),RAD(ang2))}else{bitmap.context.arc(x,y,r,RAD(ang1),RAD(ang2))}bitmap.context.stroke()}function arcfill(bitmap,x,y,ang1,ang2,r,colour){_fillstyle(bitmap,colour);bitmap.context.beginPath();if(ang1>ang2){bitmap.context.arc(x,y,r,RAD(ang1),RAD(ang2))}else{bitmap.context.arc(x,y,r,RAD(ang1),RAD(ang2))}bitmap.context.fill()}function ellipse(bitmap,x,y,rx,ry,colour,width){_strokestyle(bitmap,colour,width);bitmap.context.save();bitmap.context.translate(x,y);bitmap.context.scale(rx,ry);bitmap.context.beginPath();bitmap.context.arc(0,0,1,0,PI2);bitmap.context.restore();bitmap.context.stroke()}function ellipsefill(bitmap,x,y,rx,ry,colour){_fillstyle(bitmap,colour);bitmap.context.save();bitmap.context.translate(x,y);bitmap.context.scale(rx,ry);bitmap.context.beginPath();bitmap.context.arc(0,0,1,0,PI2);bitmap.context.restore();bitmap.context.fill()}function draw_sprite(bmp,sprite,x,y){bmp.context.drawImage(sprite.canvas,x-sprite.w/2,y-sprite.h/2)}function scaled_sprite(bmp,sprite,x,y,sx,sy){sy=typeof sy!=="undefined"?sy:sx;var u=sx*sprite.w/2;var v=sy*sprite.h/2;bmp.context.save();bmp.context.translate(x-u,y-v);bmp.context.scale(sx,sy);bmp.context.drawImage(sprite.canvas,0,0);bmp.context.restore()}function rotate_sprite(bmp,sprite,x,y,angle){var u=sprite.w/2;var v=sprite.h/2;bmp.context.save();bmp.context.translate(x,y);bmp.context.rotate(RAD(angle));bmp.context.translate(-u,-v);bmp.context.drawImage(sprite.canvas,0,0);bmp.context.restore()}function pivot_sprite(bmp,sprite,x,y,cx,cy,angle){bmp.context.save();bmp.context.translate(x,y);bmp.context.rotate(RAD(angle));bmp.context.translate(-cx,-cy);bmp.context.drawImage(sprite.canvas,0,0);bmp.context.restore()}function rotate_scaled_sprite(bmp,sprite,x,y,angle,sx,sy){sy=typeof sy!=="undefined"?sy:sx;var u=sx*sprite.w/2;var v=sy*sprite.h/2;bmp.context.save();bmp.context.translate(x,y);bmp.context.rotate(RAD(angle));bmp.context.translate(-u,-v);bmp.context.scale(sx,sy);bmp.context.drawImage(sprite.canvas,0,0);bmp.context.restore()}function pivot_scaled_sprite(bmp,sprite,x,y,cx,cy,angle,sx,sy){sy=typeof sy!=="undefined"?sy:sx;var u=sx*cx;var v=sy*cy;bmp.context.save();bmp.context.translate(x,y);bmp.context.rotate(RAD(angle));bmp.context.translate(-u,-v);bmp.context.scale(sx,sy);bmp.context.drawImage(sprite.canvas,0,0);bmp.context.restore()}function blit(source,dest,sx,sy,dx,dy,w,h){dest.context.drawImage(source.canvas,sx,sy,w,h,dx,dy,w,h)}function simple_blit(source,dest,x,y){dest.context.drawImage(source.canvas,x,y)}function stretch_blit(source,dest,sx,sy,sw,sh,dx,dy,dw,dh){dest.context.drawImage(source.canvas,sx,sy,sw,sh,dx,dy,dw,dh)}var _cartoon_woff="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";var _num_fonts=0;function FONT_OBJECT(element,file,name,type){}function load_base64_font(data){var s=document.createElement("style");var fontname="font"+_num_fonts++;s.id=fontname;s.type="text/css";document.head.appendChild(s);s.textContent="@font-face { font-family: "+fontname+"; src:url('data:application/font-woff;base64,"+data+"') format('woff');}";return{element:s,file:"",name:fontname,type:"fnt"}}function load_font(filename){var s=document.createElement("style");var fontname="font"+_num_fonts++;s.id=fontname;s.type="text/css";document.head.appendChild(s);s.textContent="@font-face { font-family: "+fontname+"; src:url('"+filename+"');}";return{element:s,file:filename,name:fontname,type:"fnt"}}function create_font(family){return{element:null,file:"",name:family,type:"fnt"}}function textout(bitmap,f,s,x,y,size,colour,outline,width){bitmap.context.font=size.toFixed()+"px "+f.name;bitmap.context.textAlign="left";_fillstyle(bitmap,colour);bitmap.context.fillText(s,x,y);if(outline){_strokestyle(bitmap,outline,width);bitmap.context.strokeText(s,x,y)}}function textout_centre(bitmap,f,s,x,y,size,colour,outline,width){bitmap.context.font=size.toFixed()+"px "+f.name;bitmap.context.textAlign="center";_fillstyle(bitmap,colour);bitmap.context.fillText(s,x,y);if(outline){_strokestyle(bitmap,outline,width);bitmap.context.strokeText(s,x,y)}}function textout_right(bitmap,f,s,x,y,size,colour,outline,width){bitmap.context.font=size.toFixed()+"px "+f.name;bitmap.context.textAlign="right";_fillstyle(bitmap,colour);bitmap.context.fillText(s,x,y);if(outline){_strokestyle(bitmap,outline,width);bitmap.context.strokeText(s,x,y)}}var _volume=1;var _samples=[];function SAMPLE_OBJECT(element,file,volume,ready,type){}function install_sound(){}function set_volume(volume){_volume=volume;for(var c=0;c<_samples.length;c++){_samples[c].element.volume=_samples[c].volume*_volume}}function get_volume(){return _volume}function load_sample(filename){var audio=document.createElement("audio");audio.src=filename;var sample={element:audio,file:filename,volume:1,ready:false,type:"snd"};_downloadables.push(sample);_samples.push(sample);log("Loading sample "+filename+"...");audio.onloadeddata=function(){if(!sample.ready){sample.ready=true;log("Sample "+filename+" loaded!")}};return sample}function destroy_sample(filename){}function play_sample(sample,vol,freq,loop){vol=typeof vol!=="undefined"?vol:1;freq=typeof freq!=="undefined"?vol:1;loop=typeof loop!=="undefined"?loop:false;adjust_sample(sample,vol,freq,loop);sample.element.currentTime=0;sample.element.play()}function adjust_sample(sample,vol,freq,loop){sample.volume=vol;sample.element.volume=sample.volume*_volume;sample.element.loop=loop;sample.element.playbackRate=freq}function stop_sample(sample){sample.element.pause();sample.element.currentTime=0}function pause_sample(sample){sample.element.pause()}function rand(){return Math.floor(65536*Math.random())}function rand32(){return rand()|rand()<<16}function frand(){return Math.random()}function abs(a){return a<0?-a:a}function length(x,y){return Math.sqrt(x*x+y*y)}function distance(x1,y1,x2,y2){return Math.sqrt((x2-x1)*(x2-x1)+(y2-y1)*(y2-y1))}function distance2(x1,y1,x2,y2){return(x2-x1)*(x2-x1)+(y2-y1)*(y2-y1)}function linedist(ex1,ey1,ex2,ey2,x,y){var px=ex2-ex1;var py=ey2-ey1;var u=((x-ex1)*px+(y-ey1)*py)/(px*px+py*py);if(u>1)u=1;else if(u<0)u=0;var dx=ex1+u*px-x;var dy=ey1+u*py-y;return Math.sqrt(dx*dx+dy*dy)}function lerp(from,to,progress){return from+(to-from)*progress}function dot(x1,y1,x2,y2){return x1*x2+y1*y2}function sgn(a){return a<0?-1:a>0?1:0}function angle(x1,y1,x2,y2){var a=DEG(Math.atan2(y2-y1,x2-x1));return a<0?a+360:a}function anglediff(a,b){var diff=b-a;diff/=360;diff=(diff-floor(diff))*360;if(diff>180){diff-=360}return diff}function clamp(value,min,max){if(max>min){if(value<min)return min;else if(value>max)return max;else return value}else{if(value<max)return max;else if(value>min)return min;else return value}}function scale(value,min,max,min2,max2){return min2+(value-min)/(max-min)*(max2-min2)}function scaleclamp(value,min,max,min2,max2){value=min2+(value-min)/(max-min)*(max2-min2);if(max2>min2){value=value<max2?value:max2;return value>min2?value:min2}value=value<min2?value:min2;return value>max2?value:max2}var _debug_enabled=false;var _debug_element;var ALLEGRO_CONSOLE=false;function _error(string){log("[ERROR] "+string);alert(string)}function _onerror(e){var fa=e.filename.split("/");fa.reverse();log("["+fa[0]+":"+e.lineno+":"+e.colno+"] "+e.message)}function enable_debug(id){_debug_element=document.getElementById(id);window.addEventListener("error",_onerror);if(_debug_element)_debug_enabled=true}function log(string){if(ALLEGRO_CONSOLE&&console)console.log(string);if(!_debug_enabled)return;_debug_element.innerHTML=_debug_element.innerHTML+string+"<br/>"}function wipe_log(){if(!_debug_enabled)return;_debug_element.innerHTML=""}